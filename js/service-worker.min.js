const CACHE_NAME="truyen-cache-v2.0.0",CACHE_DURATION=3e5;async function handleRequest(e){try{const t=await caches.open(CACHE_NAME),n=await t.match(e);if(n){const a=n.headers.get("x-cache-timestamp"),s=Date.now();if(a&&s-parseInt(a)<3e5)return n;await t.delete(e)}const a=await fetch(e);if(a.ok){const n=a.clone(),s=new Headers(n.headers);s.set("x-cache-timestamp",Date.now().toString());const i=new Response(await n.blob(),{status:n.status,statusText:n.statusText,headers:s});return await t.put(e,i.clone()),i}return a}catch(t){console.error("Error in handleRequest:",t);const n=await caches.open(CACHE_NAME),a=await n.match(e);return a?(console.log("Network failed, serving stale cache:",e.url),a):new Response('\n      <!DOCTYPE html>\n      <html lang="vi">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>Lá»—i káº¿t ná»‘i</title>\n      </head>\n      <body style="\n        padding: 0;\n        width: 100vw;\n        height: 100vh;\n        background: rgba(0,0,0,0.9);\n        display: flex;\n        align-items: flex-start;\n        justify-content: center;\n        max-width: 800px;\n        margin: 0 auto;\n      ">\n        <div style="\n          width: 100%;\n          padding: 40px 20px;\n          animation: fadeIn 0.5s ease-in;\n          text-align: center;\n          display: flex;\n          justify-content: center;\n        ">\n          <h1 style="\n            color: #fff;\n            font-size: 22px;\n            line-height: 40px;\n            font-weight: 600;\n            text-align: center;\n            margin: 0;\n            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 20px;\n          ">\n            HÃ£y kiá»ƒm tra káº¿t ná»‘i máº¡ng cá»§a báº¡n\n            <ul style="\n              padding:0 20px;\n              margin: 0;\n              margin-top: 20px;\n              color: #aeed31;\n              line-height: 30px;\n              font-weight: 400;\n              text-align: left;\n              text-shadow: 2px 2px 4px rgba(0,0,0,0.5);\n            ">\n              <li style="text-align: left;margin-bottom: 12px;"><a href="https://eyep.blog/EwX5vNgg" style="color: red; text-decoration: underline;" target="_blank">Táº£i á»©ng dá»¥ng</a> vá» Ä‘iá»‡n thoáº¡i cá»§a báº¡n Ä‘á»ƒ Ä‘á»c truyá»‡n khÃ´ng cÃ³ quáº£ng cÃ¡o</li>\n              <li style="text-align: left;margin-bottom: 12px;">HÃ£y thá»­ báº­t wifi/4G/5G Ä‘á»ƒ truy cáº­p láº¡i trang web</li>\n              <li style="text-align: left;margin-bottom: 12px;">Má»Ÿ áº©n danh truy cáº­p láº¡i trang web</li>\n            </ul>\n            Náº¿u khÃ´ng Ä‘Æ°á»£c hÃ£y gá»­i tin nháº¯n cho admin qua zalo: 0976096541, báº¡n Ä‘ang dÃ¹ng máº¡ng vietel, mobifone, vinaphone, fpt, vnpt hay máº¡ng nÃ o khÃ¡c Ä‘á»ƒ admin kiá»ƒm tra vÃ  há»— trá»£ báº¡n.\n          </h1>\n        </div>\n        <style>\n          @keyframes fadeIn {\n            from { opacity: 0; }\n            to { opacity: 1; }\n          }\n        </style>\n      </body>\n      </html>\n    ',{status:503,statusText:"Service Unavailable",headers:{"Content-Type":"text/html;charset=UTF-8"}})}}async function clearCache(){const e=await caches.delete(CACHE_NAME);return console.log("Cache cleared:",e),e}self.addEventListener("install",e=>{console.log("Service Worker installing..."),e.waitUntil(caches.open(CACHE_NAME).then(e=>(console.log("Cache opened"),e))),self.skipWaiting()}),self.addEventListener("activate",e=>{console.log("Service Worker activating..."),e.waitUntil(caches.keys().then(e=>Promise.all(e.map(e=>{if(e!==CACHE_NAME)return console.log("Deleting old cache:",e),caches.delete(e)})))),self.clients.claim()}),self.addEventListener("fetch",e=>{if("GET"!==e.request.method)return;const t=new URL(e.request.url);t.origin.includes("chrome-extension")||t.hostname.includes("facebook.com")||t.hostname.includes("fb.com")||t.hostname.includes("spreadsheets")||t.pathname.startsWith("/api")||t.pathname.startsWith("/wp-ajax")||t.pathname.startsWith("/wp-admin")||t.pathname.startsWith("/wp-login.php")||e.respondWith(handleRequest(e.request))}),self.addEventListener("message",e=>{e.data&&"CLEAR_CACHE"===e.data.type&&caches.delete(CACHE_NAME).then(()=>{console.log("Cache cleared"),e.ports&&e.ports[0]&&e.ports[0].postMessage({success:!0}),e.source&&e.source.postMessage({success:!0})}).catch(t=>{console.error("Error clearing cache:",t),e.ports&&e.ports[0]&&e.ports[0].postMessage({success:!1,error:t.message}),e.source&&e.source.postMessage({success:!1,error:t.message})})});