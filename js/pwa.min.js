!function(){"use strict";let e;"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/service-worker.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)}).catch(function(e){console.log("ServiceWorker registration failed: ",e)})});let n=!1;window.addEventListener("beforeinstallprompt",function(t){t.preventDefault(),e=t,window.innerWidth<=768&&!n&&function(){const t=document.getElementById("pwa-install-prompt");if(!t)return;if(!localStorage.getItem("pwa-prompt-dismissed")){setTimeout(function(){t.style.display="block",setTimeout(function(){t.style.transform="translateY(0)"},10)},2e3),n=!0;const o=document.getElementById("pwa-install-btn");o&&o.addEventListener("click",function(){t.style.transform="translateY(100%)",setTimeout(function(){t.style.display="none"},300),e&&(e.prompt(),e.userChoice.then(function(n){"accepted"===n.outcome?(console.log("User accepted the install prompt"),r("Cảm ơn bạn đã cài đặt ứng dụng!","success")):console.log("User dismissed the install prompt"),e=null}))});const i=document.getElementById("pwa-dismiss-btn");i&&i.addEventListener("click",function(){t.style.transform="translateY(100%)",setTimeout(function(){t.style.display="none"},300),localStorage.setItem("pwa-prompt-dismissed",Date.now())});const s=document.getElementById("pwa-close-btn");s&&s.addEventListener("click",function(){t.style.transform="translateY(100%)",setTimeout(function(){t.style.display="none"},300),localStorage.setItem("pwa-prompt-dismissed",Date.now())}),setTimeout(function(){"none"!==t.style.display&&(t.style.transform="translateY(100%)",setTimeout(function(){t.style.display="none"},300))},15e3)}}()}),function(){const e=localStorage.getItem("pwa-prompt-dismissed");if(e){(Date.now()-e)/864e5>7&&localStorage.removeItem("pwa-prompt-dismissed")}}(),window.addEventListener("appinstalled",function(e){console.log("PWA was installed");const n=document.getElementById("pwa-install-prompt");n&&(n.style.transform="translateY(100%)",setTimeout(function(){n.style.display="none"},300))});let t=navigator.onLine,o=null;function i(){return new Promise(e=>{if(!navigator.onLine)return void e(!1);const n=new AbortController,t=setTimeout(()=>n.abort(),3e3);fetch("/manifest.json",{method:"HEAD",cache:"no-cache",signal:n.signal}).then(()=>{clearTimeout(t),e(!0)}).catch(()=>{clearTimeout(t),e(!1)})})}function s(e=!1){if(e){const e=t;t=navigator.onLine,t&&!e?i().then(e=>{a(e)}):a(t)}else i().then(e=>{t=e,a(e)})}function a(e){const n=document.body.classList.contains("offline");e?(document.body.classList.remove("offline"),n&&(r("Đã kết nối internet","success"),document.body.classList.remove("was-offline"))):n||(document.body.classList.add("offline"),document.body.classList.add("was-offline"),r("Mất kết nối internet - Đang sử dụng chế độ offline","warning"))}function r(e,n="info"){const t=document.createElement("div");t.style.cssText=`\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      padding: 12px 20px;\n      border-radius: 8px;\n      color: white;\n      z-index: 10000;\n      font-size: 14px;\n      max-width: 300px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n      transform: translateX(120%);\n      transition: transform 0.3s ease;\n      background: ${"success"===n?"#4CAF50":"warning"===n?"#FF9800":"#2196F3"};\n    `,t.textContent=e,document.body.appendChild(t),setTimeout(function(){t.style.transform="translateX(0)"},10),setTimeout(function(){t.style.transform="translateX(120%)",setTimeout(function(){t.remove()},300)},3e3)}window.addEventListener("online",()=>s(!0)),window.addEventListener("offline",()=>s(!0)),s(),function e(){o&&clearTimeout(o),t||(o=setTimeout(()=>{s(),e()},1e4))}();const c=document.createElement("style");c.textContent='\n    .offline {\n      filter: grayscale(0.3);\n    }\n    .offline::before {\n      content: "Chế độ Offline";\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      background: #f44336;\n      color: white;\n      text-align: center;\n      padding: 8px;\n      z-index: 9999;\n      font-size: 14px;\n      font-weight: bold;\n      box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n    }\n  ',document.head.appendChild(c),"serviceWorker"in navigator&&"SyncManager"in window&&document.addEventListener("submit",function(e){const n=e.target;if("true"===n.dataset.pwasync&&!t){e.preventDefault();const t=new FormData(n),a={};t.forEach(function(e,n){a[n]=e}),o=n.action,i=a,s=n.method,console.log("Saving form data for later:",o,i,s),navigator.serviceWorker.ready.then(function(e){e.sync.register("form-submission")}),r("Form sẽ được gửi khi có kết nối internet","info")}var o,i,s}),window.clearPWACache=function(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{const n=new MessageChannel;n.port1.onmessage=e=>{e.data&&e.data.success?r("Đã xóa cache thành công","success"):r("Không thể xóa cache","warning")},e.active.postMessage({type:"CLEAR_CACHE"},[n.port2])})},function(){const e=localStorage.getItem("pwa-last-visit"),n=Date.now();if(localStorage.setItem("pwa-last-visit",n),e){(n-e)/6e4>30&&r("Chào mừng bạn quay trở lại!","info")}}()}();