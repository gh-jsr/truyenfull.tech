($=>{function loadUserContent(){var $container=$("#user-info"),$mobileContainer=$("#user-info-mobile");0===$container.length&&0===$mobileContainer.length||$.ajax({url:twUserForms.ajaxUrl,type:"POST",data:{action:"get_user_sidebar"},success:function(response){response.success&&(0<$container.length&&($container.html(response.data.html),$container.removeClass("loading-user-info")),0<$mobileContainer.length&&($mobileContainer.html(response.data.mobile_html),$mobileContainer.removeClass("loading-user-info")),twUserForms&&(response.data.html.includes("form")||response.data.mobile_html.includes("form"))&&$.ajax({url:twUserForms.ajaxUrl,type:"POST",data:{action:"get_nonce"}}).then(function(nonceResponse){nonceResponse.success&&(twUserForms.nonce=nonceResponse.data.nonce)}),SidebarForm.init(),MobileForm.init(),$(".progress-bar").each(function(){var $this=$(this),width=$this.attr("style").match(/width:\s*(\d+)%/);width&&($this.css("width","0%"),setTimeout(function(){$this.css("width",width[0])},500))}))},error:function(){var errorMessage='<div class="alert-error">Không thể tải thông tin người dùng</div>';0<$container.length&&($container.html(errorMessage),$container.removeClass("loading-user-info")),0<$mobileContainer.length&&($mobileContainer.html(errorMessage),$mobileContainer.removeClass("loading-user-info"))}})}var SidebarForm={init:function(){$(".form-tabs .tab-btn").click(function(){var tab=$(this).data("tab");$(".form-tabs .tab-btn").removeClass("active"),$(this).addClass("active"),$(".tab-content").hide(),$("#sidebar-"+tab+"-tab").show(),$("#sidebarAlertMessage").hide()}),$("#sidebarLoginForm").submit(function(e){e.preventDefault();var e=$(this),$btn=e.find('button[type="submit"]'),originalText=$btn.html();$btn.addClass("btn-loading").html('<i class="glyphicon glyphicon-refresh"></i> Đang xử lý...'),$.ajax({url:twUserForms.ajaxUrl,type:"POST",data:{action:"user_login",username:e.find('input[name="username"]').val(),password:e.find('input[name="password"]').val(),remember:e.find('input[name="remember"]').is(":checked"),nonce:twUserForms.nonce},success:function(response){response.success?(SidebarForm.showAlert("success",response.data.message),loadUserContent()):SidebarForm.showAlert("error",response.data.message)},error:function(){SidebarForm.showAlert("error","Có lỗi xảy ra. Vui lòng thử lại!")},complete:function(){$btn.removeClass("btn-loading").html(originalText)}})}),$("#sidebarRegisterForm").submit(function(e){e.preventDefault();var $form=$(this),$btn=$form.find('button[type="submit"]'),originalText=$btn.html();$btn.addClass("btn-loading").html('<i class="glyphicon glyphicon-refresh"></i> Đang xử lý...'),$.ajax({url:twUserForms.ajaxUrl,type:"POST",data:{action:"user_register",username:$form.find('input[name="username"]').val(),email:$form.find('input[name="email"]').val(),password:$form.find('input[name="password"]').val(),confirm_password:$form.find('input[name="confirm_password"]').val(),nonce:twUserForms.nonce},success:function(response){response.success?(SidebarForm.showAlert("success",response.data.message),setTimeout(function(){$('.tab-btn[data-tab="login"]').click(),$form[0].reset()},2e3)):SidebarForm.showAlert("error",response.data.message)},error:function(){SidebarForm.showAlert("error","Có lỗi xảy ra. Vui lòng thử lại!")},complete:function(){$btn.removeClass("btn-loading").html(originalText)}})})},showAlert:function(type,message){type="success"===type?"alert-success":"alert-error";$("#sidebarAlertMessage").removeClass("alert-success alert-error").addClass(type).html(message).show()}},MobileForm={init:function(){$("#mobileLoginBtn").click(function(){$("#mobileLoginForm").show(),$(".mobile-login-buttons").hide()}),$("#mobileRegisterBtn").click(function(){$("#mobileRegisterForm").show(),$(".mobile-login-buttons").hide()}),$(".mobile-form-back").click(function(){$(".mobile-form").hide(),$(".mobile-login-buttons").show(),$("#mobileAlertMessage").hide()}),$("#mobileSidebarLoginForm").submit(function(e){e.preventDefault();var e=$(this),$btn=e.find('button[type="submit"]'),originalText=$btn.html();$btn.addClass("btn-loading").html('<i class="glyphicon glyphicon-refresh"></i> Đang xử lý...'),$.ajax({url:twUserForms.ajaxUrl,type:"POST",data:{action:"user_login",username:e.find('input[name="username"]').val(),password:e.find('input[name="password"]').val(),remember:e.find('input[name="remember"]').is(":checked"),nonce:twUserForms.nonce},success:function(response){response.success?(MobileForm.showAlert("success",response.data.message),loadUserContent()):MobileForm.showAlert("error",response.data.message)},error:function(){MobileForm.showAlert("error","Có lỗi xảy ra. Vui lòng thử lại!")},complete:function(){$btn.removeClass("btn-loading").html(originalText)}})}),$("#mobileSidebarRegisterForm").submit(function(e){e.preventDefault();var $form=$(this),$btn=$form.find('button[type="submit"]'),originalText=$btn.html();$btn.addClass("btn-loading").html('<i class="glyphicon glyphicon-refresh"></i> Đang xử lý...'),$.ajax({url:twUserForms.ajaxUrl,type:"POST",data:{action:"user_register",username:$form.find('input[name="username"]').val(),email:$form.find('input[name="email"]').val(),password:$form.find('input[name="password"]').val(),confirm_password:$form.find('input[name="confirm_password"]').val(),nonce:twUserForms.nonce},success:function(response){response.success?(MobileForm.showAlert("success",response.data.message),setTimeout(function(){$(".mobile-form").hide(),$(".mobile-login-buttons").show(),$form[0].reset()},2e3)):MobileForm.showAlert("error",response.data.message)},error:function(){MobileForm.showAlert("error","Có lỗi xảy ra. Vui lòng thử lại!")},complete:function(){$btn.removeClass("btn-loading").html(originalText)}})})},showAlert:function(type,message){type="success"===type?"alert-success":"alert-error";$("#mobileAlertMessage").removeClass("alert-success alert-error").addClass(type).html(message).show()}},ModalForm={init:function(){$("#showRegister").click(function(e){e.preventDefault(),$("#loginForm").hide(),$("#registerForm").show(),$("#loginModalLabel").text("Đăng ký"),$("#alertMessage").hide()}),$("#showLogin").click(function(e){e.preventDefault(),$("#registerForm").hide(),$("#loginForm").show(),$("#loginModalLabel").text("Đăng nhập"),$("#alertMessage").hide()}),$("#userLoginForm").submit(function(e){e.preventDefault();var $btn=$(this).find('button[type="submit"]'),originalText=$btn.text();$btn.prop("disabled",!0).text("Đang xử lý..."),$.ajax({url:twUserForms.ajaxUrl,type:"POST",data:{action:"user_login",username:$("#loginUsername").val(),password:$("#loginPassword").val(),remember:$("#rememberMe").is(":checked"),nonce:twUserForms.nonce},success:function(response){response.success?(ModalForm.showAlert("success",response.data.message),loadUserContent(),setTimeout(function(){$("#loginModal").modal("hide")},1500)):ModalForm.showAlert("danger",response.data.message)},error:function(){ModalForm.showAlert("danger","Có lỗi xảy ra. Vui lòng thử lại!")},complete:function(){$btn.prop("disabled",!1).text(originalText)}})}),$("#userRegisterForm").submit(function(e){e.preventDefault();var $btn=$(this).find('button[type="submit"]'),originalText=$btn.text();$btn.prop("disabled",!0).text("Đang xử lý..."),$.ajax({url:twUserForms.ajaxUrl,type:"POST",data:{action:"user_register",username:$("#registerUsername").val(),email:$("#registerEmail").val(),password:$("#registerPassword").val(),confirm_password:$("#confirmPassword").val(),nonce:twUserForms.nonce},success:function(response){response.success?(ModalForm.showAlert("success",response.data.message),setTimeout(function(){$("#showLogin").click(),$("#userRegisterForm")[0].reset()},2e3)):ModalForm.showAlert("danger",response.data.message)},error:function(){ModalForm.showAlert("danger","Có lỗi xảy ra. Vui lòng thử lại!")},complete:function(){$btn.prop("disabled",!1).text(originalText)}})}),$("#loginModal").on("hidden.bs.modal",function(){$("#userLoginForm")[0].reset(),$("#userRegisterForm")[0].reset(),$("#alertMessage").hide(),$("#registerForm").hide(),$("#loginForm").show(),$("#loginModalLabel").text("Đăng nhập")})},showAlert:function(type,message){type=`
        <div class="alert alert-${type} alert-dismissible fade show" role="alert">
          ${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      `;$("#alertMessage").html(type).show()}};$(document).ready(function(){loadUserContent(),ModalForm.init(),MobileForm.init()})})(jQuery),jQuery(document).ready(function($){$("#dailyCheckinBtn").on("click",function(){$(this).prop("disabled",!0).html('<i class="glyphicon glyphicon-refresh"></i> Đang xử lý...'),$.ajax({url:window.wp.ajaxUrl,type:"POST",data:{action:"daily_checkin",nonce:window.wp.nonce},success:function(response){response.success?(alert(response.data.message),location.reload()):(alert(response.data.message),$("#dailyCheckinBtn").prop("disabled",!1).html('<i class="glyphicon glyphicon-calendar"></i> Điểm danh hàng ngày'))},error:function(){alert("Có lỗi xảy ra. Vui lòng thử lại sau."),$("#dailyCheckinBtn").prop("disabled",!1).html('<i class="glyphicon glyphicon-calendar"></i> Điểm danh hàng ngày')}})})}),($=>{function initBadgeTooltips(){$(".tw-badge, .tw-featured-badge").each(function(){var $badge=$(this),title=$badge.attr("title");title&&$badge.tooltip({title:title,placement:"top",container:"body"})})}$(document).ready(function(){initBadgeTooltips(),0<$(".tw-user-badges-container").length&&(userId=>{$.ajax({url:twBadgeSystem.ajaxUrl,type:"POST",data:{action:"get_user_badges",nonce:twBadgeSystem.nonce,user_id:userId||0},success:function(response){response.success&&($(".tw-user-badges-container").html(response.data.html),initBadgeTooltips(),$(document).trigger("tw_badges_loaded",[response.data.badges]))}})})($(".tw-user-badges-container").data("user-id")||0)})})(jQuery),($=>{$(document).ready(function(){$("#badge_type").on("change",function(){var selectedType=$(this).val();selectedType&&console.log("Đã chọn loại huy hiệu: "+selectedType)}),$("#badge_level").on("change",function(){var selectedLevel=$(this).val();selectedLevel&&console.log("Đã chọn cấp độ: "+selectedLevel)})})})(jQuery);